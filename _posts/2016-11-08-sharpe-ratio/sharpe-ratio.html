<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #545454; font-weight: bold; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #a1024a; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007faa; font-weight: bold; } /* ControlFlow */
code span.ch { color: #008000; } /* Char */
code span.cn { color: #d91e18; } /* Constant */
code span.co { color: #545454; } /* Comment */
code span.cv { color: #545454; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #aa5d00; } /* DataType */
code span.dv { color: #a1024a; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #a1024a; } /* Float */
code span.fu { color: #4254a7; } /* Function */
code span.im { } /* Import */
code span.in { color: #545454; font-weight: bold; } /* Information */
code span.kw { color: #007faa; font-weight: bold; } /* Keyword */
code span.op { color: #696969; } /* Operator */
code span.ot { color: #007faa; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #008000; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #008000; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #008000; } /* VerbatimString */
code span.wa { color: #545454; font-weight: bold; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>The Sharpe Ratio</title>

  <meta property="description" itemprop="description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2016-11-08"/>
  <meta property="article:created" itemprop="dateCreated" content="2016-11-08"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="The Sharpe Ratio"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="The Sharpe Ratio"/>
  <meta property="twitter:description" content="In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We&#39;ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","date","categories","output","repository_url"]}},"value":[{"type":"character","attributes":{},"value":["The Sharpe Ratio"]},{"type":"character","attributes":{},"value":["In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We'll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio. \n"]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["11-08-2016"]},{"type":"character","attributes":{},"value":["portfolio theory","dygraphs","quarto","shiny","rmarkdown","reproducible research"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["highlight","self_contained","toc"]}},"value":[{"type":"character","attributes":{},"value":["default"]},{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://github.com/jjallaire/reproducible-finance-with-r/"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["preview.png","sharpe-ratio_files/anchor-4.2.2/anchor.min.js","sharpe-ratio_files/bowser-1.9.3/bowser.min.js","sharpe-ratio_files/distill-2.2.21/template.v2.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph-combined-dev.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph-combined.js","sharpe-ratio_files/dygraphs-1.1.1/dygraph.css","sharpe-ratio_files/dygraphs-1.1.1/shapes.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/dygraphs.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/dygraphs.yaml","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/dygraphs/dygraph-combined-dev.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/dygraphs/dygraph-combined.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/dygraphs/dygraph.css","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/dygraphs/shapes.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/fquarter/moment-fquarter.min.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/jquery/AUTHORS.txt","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/jquery/jquery.min.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/timezone/moment-timezone-with-data.js","sharpe-ratio_files/dygraphs-binding-1.1.1.4/lib/timezone/moment.js","sharpe-ratio_files/dygraphs-binding-1.1.1.6/dygraphs.js","sharpe-ratio_files/header-attrs-2.3.5/header-attrs.js","sharpe-ratio_files/header-attrs-2.3.8/header-attrs.js","sharpe-ratio_files/header-attrs-2.3/header-attrs.js","sharpe-ratio_files/htmlwidgets-1.2/htmlwidgets.js","sharpe-ratio_files/htmlwidgets-1.5.1/htmlwidgets.js","sharpe-ratio_files/jquery-1.11.3/jquery.min.js","sharpe-ratio_files/moment-2.8.4/moment-timezone-with-data.js","sharpe-ratio_files/moment-2.8.4/moment.js","sharpe-ratio_files/moment-fquarter-1.0.0/moment-fquarter.min.js","sharpe-ratio_files/moment-timezone-0.2.5/moment-timezone-with-data.js","sharpe-ratio_files/moment-timezone-0.2.5/moment.js","sharpe-ratio_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: hidden;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }


  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="sharpe-ratio_files/header-attrs-2.3.8/header-attrs.js"></script>
  <script src="sharpe-ratio_files/htmlwidgets-1.5.1/htmlwidgets.js"></script>
  <script src="sharpe-ratio_files/jquery-1.11.3/jquery.min.js"></script>
  <link href="sharpe-ratio_files/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
  <script src="sharpe-ratio_files/dygraphs-1.1.1/dygraph-combined.js"></script>
  <script src="sharpe-ratio_files/dygraphs-1.1.1/shapes.js"></script>
  <script src="sharpe-ratio_files/moment-2.8.4/moment.js"></script>
  <script src="sharpe-ratio_files/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
  <script src="sharpe-ratio_files/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
  <script src="sharpe-ratio_files/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
  <script src="sharpe-ratio_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="sharpe-ratio_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="sharpe-ratio_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="sharpe-ratio_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"The Sharpe Ratio","description":"In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We'll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio.","authors":[],"publishedDate":"2016-11-08T00:00:00.000-05:00"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>The Sharpe Ratio</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">portfolio theory</div>
<div class="dt=tag">dygraphs</div>
<div class="dt=tag">quarto</div>
<div class="dt=tag">shiny</div>
<div class="dt=tag">rmarkdown</div>
<div class="dt=tag">reproducible research</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>In this post we present a classic finance use case using the PerformanceAnalytics, quantmod, and dygraphs packages. We’ll demonstrate importing stock data, building a portfolio, and then calculating the Sharpe Ratio.</p></p>
</div>


<div class="d-article">
<div class="d-contents">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#setting-up">Setting up</a></li>
<li><a href="#preparing-the-data">Preparing the data</a></li>
<li><a href="#calculating-portfolio-returns">Calculating portfolio returns</a></li>
<li><a href="#calculating-the-sharpe-ratio">Calculating the Sharpe Ratio</a></li>
</ul>
</nav>
</div>
<h2 id="overview">Overview</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>cars</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     speed           dist       
 Min.   : 4.0   Min.   :  2.00  
 1st Qu.:12.0   1st Qu.: 26.00  
 Median :15.0   Median : 36.00  
 Mean   :15.4   Mean   : 42.98  
 3rd Qu.:19.0   3rd Qu.: 56.00  
 Max.   :25.0   Max.   :120.00  </code></pre>
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"asdfasd faskd;lfjkasldjf;klasdj f;klas jfk;ladsjf ;klasdjf k;lasdj f;klas jfk;lasdjf as;dklfj kal;dsjf;kladsj f;klasdj fk;lasdj fds\n"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>asdfasd faskd;lfjkasldjf;klasdj f;klas jfk;ladsjf ;klasdjf k;lasdj f;klas jfk;lasdjf as;dklfj kal;dsjf;kladsj f;klasdj fk;lasdj fds</code></pre>
</div>
<p>In this post we’ll demonstrate the calculation of a Sharpe Ratio for a stock portfolio. We’ll start with a function that grabs monthly stock returns and saves those monthly returns as an xts object in the global environment. With that function, we will create three xts objects of monthly returns, and merge those three xts objects into one object, before passing that merged object to dygraphs to peek at the individual stocks.</p>
<p>Then, we’ll move on to build a portfolio by selecting asset weights and calculating the portfolio monthly returns. Next, we will calculate the growth of a dollar invested in that portfolio (which is what matters to us) over time, and save the results to an xts object. Dygraphs will come in handy again for the portfolio visualizations. Finally, we will calculate the Sharpe Ratio.</p>
<h2 id="setting-up">Setting up</h2>
<p>We start by loading three packages: quantmod to download the data, PerformanceAnalytics to run portfolio calculations, and dygraphs to graph time series objects. We will also create a function to import stock data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/braverock/PerformanceAnalytics'>PerformanceAnalytics</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.quantmod.com'>quantmod</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/dygraphs'>dygraphs</a></span><span class='op'>)</span>

<span class='co'># Function to calculate monthly returns on a stock </span>
<span class='va'>monthly_stock_returns</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>ticker</span>, <span class='va'>start_year</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># Download the data from Yahoo finance</span>
  <span class='va'>symbol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/quantmod/man/getSymbols.html'>getSymbols</a></span><span class='op'>(</span><span class='va'>ticker</span>, src <span class='op'>=</span> <span class='st'>'yahoo'</span>, 
                       auto.assign <span class='op'>=</span> <span class='cn'>FALSE</span>, warnings <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  
  <span class='co'># Tranform it to monthly returns using quantmode::periodReturn</span>
  <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/quantmod/man/periodReturn.html'>periodReturn</a></span><span class='op'>(</span><span class='va'>symbol</span>, period <span class='op'>=</span> <span class='st'>'monthly'</span>, 
                       subset<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>start_year</span>, <span class='st'>"::"</span>, sep <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>,
                       type <span class='op'>=</span> <span class='st'>'log'</span><span class='op'>)</span>

  <span class='co'># Let's rename the column of returns to something intuitive because</span>
  <span class='co'># the column name is what will eventually be displayed</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ticker</span><span class='op'>)</span>

  <span class='co'># We want to be able to work with the xts objects so let's explicitly</span>
  <span class='co'># assign them into the global environment using ticker name </span>
  <span class='fu'><a href='https://rdrr.io/r/base/assign.html'>assign</a></span><span class='op'>(</span><span class='va'>ticker</span>, <span class='va'>data</span>, <span class='va'>.GlobalEnv</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>The <code>monthly_stock_returns</code> function above takes 2 parameters, a stock symbol and a year. Note that we could have included a third parameter called something like ‘period’ if we wanted the ability to grab periods other than monthly returns. For example, we can envision a desire to look at annual, weekly or daily returns. Here, I force monthly returns because I don’t want to allow different period options. It’s a choice driven by the purpose of this Notebook - which here is focused on monthly returns.</p>
<h2 id="preparing-the-data">Preparing the data</h2>
<p>In the next chunk, we choose three stock tickers and a starting year argument for the <code>monthly_stock_returns</code> function. Then, we merge them into one xts object.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co"># Choose the starting year and assign it to the &#39;year&#39; variable</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>year &lt;-<span class="st"> </span><span class="dv">2010</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co"># Use the function the monthly returns on 3 stocks, and pass in the &#39;year&#39;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co"># value. Let&#39;s choose Google, JP Morgan and Amazon</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="kw">monthly_stock_returns</span>(<span class="st">&#39;GOOG&#39;</span>, year)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="kw">monthly_stock_returns</span>(<span class="st">&#39;JPM&#39;</span>, year)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="kw">monthly_stock_returns</span>(<span class="st">&#39;AMZN&#39;</span>, year)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="co"># Merge the 3 monthly return xts objects into 1 xts object.</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>merged_returns &lt;-<span class="st"> </span><span class="kw">merge.xts</span>(GOOG, JPM, AMZN)</span></code></pre></div>
</div>
<p>Let’s graph the individual performances of each stock over time.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='co'># Before we combine these into a portfolio, graph the individual returns</span>
<span class='co'># and see if anything jumps out as unusual. It looks like something </span>
<span class='co'># affected Google in March of 2014, but didn't affect JP Morgan or Amazon.</span>
<span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, main <span class='op'>=</span> <span class='st'>"Google v JP Morgan v Amazon"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"%"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyOptions.html'>dyOptions</a></span><span class='op'>(</span>colors <span class='op'>=</span> <span class='fu'>RColorBrewer</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='st'>"Set2"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div id="htmlwidget-79307f2e17466358a46d" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-79307f2e17466358a46d">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"title":"Google v JP Morgan v Amazon","labels":["month","GOOG","JPM","AMZN"],"legend":"auto","retainDateWindow":false,"ylabel":"%","stackedGraph":false,"fillGraph":false,"fillAlpha":0.15,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colors":["#66C2A5","#FC8D62","#8DA0CB"],"colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":true,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true,"disableZoom":false},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-17T00:00:00.000Z"],[-0.156923475163864,-0.00594274958091267,0.0737499461929482,-0.0758403106140872,-0.0792836565149338,-0.0874850691368657,0.0858776567053176,-0.0745475722743666,0.15560993776202,0.154604212359134,-0.0992596153230365,0.0665822398969586,0.0107006823193912,0.0214878200115132,-0.0444013866107261,-0.0754828866718376,-0.0281068056871603,-0.0437388508131377,0.175773454069625,-0.109715437236508,-0.0491008351599218,0.140342597646532,0.0113253395766937,0.0747321959935785,-0.107426933825809,0.0636751367376283,0.0365109345532709,-0.0584232700427327,-0.0404707906589692,-0.00136097469857235,0.0872742356432869,0.0791271650290844,0.0965050813929733,-0.103521395791668,0.0262151423274459,0.0128189923723444,0.0660632084800526,0.0584794085647997,-0.00878788024636826,0.0375392942160171,0.0550325279644649,0.0104476908432684,0.00834793993331751,-0.0471075376508994,0.0336807240207494,0.162613663825404,0.0277602337154229,0.0560804493251668,0.0523736672696962,0.0289428136296406,-0.0863761773864875,-0.0559561581085337,0.0611851942757962,0.0271165008587364,-0.00641742881866186,0,0.0100264953653954,-0.0321733612446842,-0.0313402543144855,-0.0288909258659215,0.0153077889166496,0.0437063261153709,-0.0188002577785453,-0.0169024347636116,-0.009780884820959,-0.0220410873176788,0.183918030403215,-0.011834243379955,-0.0160275013881256,0.155539757009479,0.0437523474012208,0.0216861592938289,-0.021214904863745,-0.0627391996243569,0.0654275539119852,-0.072272674611784,0.0598051286153989,-0.0611191529746793,0.105087402500263,-0.00226584902458011,0.0132615101578522,0.00928404791743199,-0.034361405045321,0.0180152456099293,0.0318397570937192,0.0326202305068949,0.00768407844732035,0.0880997419073346,0.0629878183060995,-0.05993499920398,0.0236740777385942,0.0094447971838802,0.0208388822153213,0.0582526103541297,0.00468091237958305,0.0241717254234942,0.111596690356899,-0.0573514718959657,-0.0683057473384113,-0.0141136308599308,0.0643891962242456,0.0278664550670846,0.087165223290871,0.000763662619970093,-0.0205010960935714,-0.102899168260373,0.0162678913644982,-0.0552431185295555,0.0750917351489731,0.00317494772164243,0.0465715711926603,0.0128462982483188,-0.0740704116296728,-0.0208014408824221,0.118322571751589,-0.0237705098716413,0.02567547821735,0.0331681563372692,0.034973352241521,0.0242709127517643,0.0701848340578301,-0.068458649818629,-0.141329915732929,0.148271991785741,0.0578074128463569,-0.0107722394439069,0.0478933586157896,0.0971011183936204,-0.0886605040752396],[-0.0677594231746815,0.0749331269085229,0.0641363435488222,-0.0497067382851234,-0.0730607157307516,-0.0780025362579037,0.095533588577059,-0.102385746212117,0.0456945913302789,-0.0113622569624197,-0.00613087328346648,0.125949144092543,0.057708342516328,0.0382017430596914,-0.012717080946329,-0.0102474897639365,-0.0537993778302421,-0.0546584832173214,-0.0120408875807746,-0.0741269872622494,-0.220750244831906,0.143277806727567,-0.115448281163992,0.0710358054060645,0.114938532738255,0.0507033858254425,0.158509833669475,-0.0674716281206711,-0.25969211425067,0.0749478950716236,0.00752826642079159,0.0311755905433013,0.0861134959797987,0.0292133724659014,-0.0144999636992634,0.0679861721896497,0.0677032388419057,0.0389754251584931,-0.030299039998654,0.0321370881762147,0.107826397680209,-0.0335289180151601,0.0541968038029388,-0.0979514020678516,0.0226971203482526,-0.00290609523522141,0.104545280471746,0.021781310343152,-0.0548274860685252,0.0260310470530441,0.0662200362445498,-0.0811139285832842,-0.00735099679547753,0.0362262250094673,0.000867360645947188,0.0303985670104041,0.0132009767345203,0.00397611517910871,-0.00530505222969323,0.0394380905582436,-0.14044931260639,0.11945705152036,-0.011488670500511,0.0432883476486606,0.0390626392967743,0.0296562543010153,0.0112995111458456,-0.0668272582802071,-0.0500623764041423,0.0523997674540955,0.0371233341072642,-0.00979588882074462,-0.104132856510265,-0.0552817951679289,0.050564822175977,0.0650449774159643,0.0322281497086055,-0.0491425788119945,0.0290243512221665,0.0537133587841103,-0.0135732418250343,0.0393132117975222,0.1462817872569,0.0735643730011722,-0.019424949875453,0.0683861941106749,-0.0311580401203875,-0.00960881356929515,-0.0573612498255978,0.106698631512956,0.00436682996424063,-0.00996235717781431,0.0495810018584932,0.0520206912564674,0.0381267457064417,0.0228895362728906,0.0784733437940807,-0.0014707620548938,-0.0490629195456161,-0.0108801256142838,-0.0164051780731966,-0.0266102062002726,0.0981851245824074,-0.00322393867540182,-0.0153024357501124,-0.0344395265671245,0.019709143584139,-0.130158046511978,0.0584891915150154,0.00827485714531927,-0.0304512846045996,0.136625973325229,-0.0909595036050268,0.0536499325882847,0.0368786035517346,-0.0543833540893963,0.0688472288663998,0.0596194505212631,0.0533085315169692,0.0563654073632153,-0.0518219646762515,-0.130987464357127,-0.254395089238461,0.061702145122288,0.0160566561457605,-0.0339688830271471,0.0270598685849448,0.0360756793944208,-0.016402923740242],[-0.0701245148760827,-0.0575196623895439,0.136893567731982,0.00974832325816504,-0.0887236556340148,-0.138256593425397,0.0760215965490202,0.0572008498631966,0.229675057527992,0.0507105332414788,0.059730627276336,0.0258878051596539,-0.0592783121786566,0.0212879125458854,0.038712388935758,0.0834659509080555,0.0044841043288335,0.03889020355271,0.0844979042002083,-0.0333097979916867,0.00463543229566491,-0.0126589909258005,-0.104679033802036,-0.105135115914938,0.116254145618996,-0.0788904873945619,0.119556088284576,0.135516975035046,-0.0854366583959824,0.0700100059141801,0.0214456259799021,0.0621916878529422,0.0240764643876195,-0.0880271093350996,0.0790612576392142,-0.00469263568793493,0.0566799839388883,-0.0046435745162769,0.00836541575914156,-0.0487507341974534,0.0588686946196899,0.0310507484367332,0.0813355073197074,-0.0695573665313368,0.106768885260724,0.152183862243067,0.0781496851166951,0.0130490209232016,-0.105976473840373,0.00946192206609069,-0.0737087036322837,-0.100756471692138,0.0273091599667819,0.0383836089739706,-0.0369768177598495,0.0799469118674444,-0.0502010424474244,-0.0540982709395649,0.103118832828954,-0.0872369283148209,0.133092253612408,0.0697992614510298,-0.0214295757788365,0.12532119723544,0.0175090827120903,0.011258945233946,0.211162140770996,-0.0443525909565236,-0.00195163896276899,0.201080864764985,0.0602955732152581,0.0165441376110926,-0.141005543273693,-0.0605351517985533,0.071783432265913,0.105345370506125,0.0915002222973983,-0.00996940026729571,0.0586021212098462,0.0135475611376259,0.0848953947219124,-0.0583892896398108,-0.0509721530584146,-0.000933075697601464,0.0936393869486938,0.0258446990267002,0.0479422834635129,0.0424566948881004,0.0725778338055346,-0.0271286623612071,0.0202279429701722,-0.0072954255044279,-0.0198260830888692,0.139515480102502,0.0626576785252975,-0.00620577137162303,0.21562654165298,0.0415536485469599,-0.044003454669149,0.078880245905968,0.0397392443731141,0.0421637701719449,0.0446634677481587,0.124307959658484,-0.00483599663227122,-0.225886945279117,0.0560700302202712,-0.11805158115918,0.134808073899251,-0.0469930832703517,0.0824420727817719,0.0786806530561674,-0.0818754485843349,0.0646557962234502,-0.0142805875211673,-0.0496880955663823,-0.0229951503215157,0.0232034251318763,0.013495821526094,0.0257863331642647,0.0834803178753701,-0.0642332179015806,0.0344212866895726,0.238150516322155,-0.0128673467032408,0.121834149458665,0.137248846426532,0.0866005187520025,-0.137134385737297]],"fixedtz":false,"tzone":"UTC"},"evals":[],"jsHooks":[]}</script>
</div>
<p>Nothing earth-shattering thus far: we have an xts object of three time series and have seen that one of them had weird behavior in April of 2014 (a Google stock split). We’ll ignore that behavior for this example and go on to constructing a portfolio.</p>
<h2 id="calculating-portfolio-returns">Calculating portfolio returns</h2>
<p>Here we’ll find the monthly returns of a weighted combination of assets. Unsurprisingly, we start out by choosing those weights.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='co'># We have the 3 monthly returns saved in 1 object.</span>
<span class='co'># Now, let's choose the respective weights of those 3.</span>
<span class='co'># Here we'll allocate 25% to Google, 25% to JP Morgan and 50% to Amazon.</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.25</span>, <span class='fl'>.25</span>, <span class='fl'>.50</span><span class='op'>)</span>

<span class='co'># Now use the built in PerformanceAnalytics function Return.portfolio</span>
<span class='co'># to calculate the monthly returns on the portfolio,</span>
<span class='va'>portfolio_monthly_returns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html'>Return.portfolio</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, weights <span class='op'>=</span> <span class='va'>w</span><span class='op'>)</span>

<span class='co'># Use dygraphs to chart the portfolio monthly returns.</span>
<span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, main <span class='op'>=</span> <span class='st'>"Portfolio Monthly Return"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"%"</span><span class='op'>)</span>
</code></pre>
</div>
<div id="htmlwidget-1399716e8228581aa3e4" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-1399716e8228581aa3e4">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Portfolio Monthly Return","labels":["month","portfolio.returns"],"legend":"auto","retainDateWindow":false,"ylabel":"%"},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-17T00:00:00.000Z"],[-0.0912329820226776,-0.011588982191268,0.101872598776065,-0.025720524817289,-0.0825732965952479,-0.111276318725566,0.0835846802859876,-0.0165645995799018,0.167403015733401,0.058128300538135,0.0097420341251,0.0550499358463743,-0.0188609627718943,0.0254034964018344,0.00876471867375406,0.0295662205203198,-0.0146937726068812,0.00375939998589492,0.0797468382561011,-0.0549880276118979,-0.0465181942768634,0.037252668911768,-0.0846399324523329,-0.039189242666973,0.0639642660881099,-0.0265463690144799,0.109793932865893,0.0536178433438788,-0.110299689295371,0.057080545304947,0.0311657595753718,0.0605941207151006,0.0475782337092243,-0.0727533518323087,0.0523284767428425,0.0105466275231523,0.0603897837422012,0.0151565440235142,-0.00197658353317087,-0.0174716167615456,0.0669497170028621,0.0145595343786769,0.0612484085288638,-0.0701792960427091,0.0773807469652159,0.128725433432546,0.0718763820306785,0.0226301490321545,-0.0668846267124401,0.0163337914158352,-0.0551912894583145,-0.0875451649418648,0.0289727625604941,0.0353861004147398,-0.023537135048717,0.0525491568765393,-0.0260178599358966,-0.0388297692285209,0.0517906329420024,-0.0527404790045424,0.0551282675884852,0.0719225043776599,-0.0192796817540491,0.0824824842309901,0.015750748456399,0.00809768130781441,0.17355804353257,-0.0416842448919723,-0.0111750172337142,0.173044321865371,0.0545451320034718,0.0143981634343322,-0.115125013201448,-0.0603713373961802,0.0680564876626826,0.0653654893527775,0.0792508696037866,-0.0229509022197711,0.0630772924333125,0.0149776327457951,0.062421955670624,-0.0379283858162481,-0.0271161320919227,0.0115933382814009,0.0682014230688663,0.0321562875697596,0.0313961037108836,0.0434533315125958,0.0562923594739815,-0.0190461910896639,0.0189676296235293,-0.00492512435738846,-0.00549063180328679,0.115700863148428,0.0507970343298023,0.00156594503116114,0.184215767137251,0.0228590095949037,-0.0477459054844236,0.0578166693826099,0.0375041626347967,0.0343085176178191,0.054375730542944,0.0974907973569297,-0.00748311865935347,-0.196819843473925,0.0475513235597855,-0.111334808702717,0.120083604746496,-0.0359517805373709,0.067730208861017,0.0747937740442957,-0.0816923929698289,0.0532073594364639,0.00519881341433281,-0.0467932009049613,-0.00875328039876277,0.0279228471568307,0.0202127060737287,0.0285932364659449,0.0679550686509944,-0.0708159550876065,-0.0140683035138599,0.216149991749553,-0.00325854899126776,0.0970806192390337,0.122075071636599,0.0853584562162863,-0.126918872994996]]},"evals":[],"jsHooks":[]}</script>
</div>
<p>Now, instead of looking at monthly returns, let’s look at how $1 would have grown in this portfolio.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='co'># Add the wealth.index = TRUE argument and, instead of monthly returns,</span>
<span class='co'># the function will return the growth of $1 invested in the portfolio.</span>
<span class='va'>dollar_growth</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.portfolio.html'>Return.portfolio</a></span><span class='op'>(</span><span class='va'>merged_returns</span>, weights <span class='op'>=</span> <span class='va'>w</span>, 
                                  wealth.index <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Use dygraphs to chart the growth of $1 in the portfolio.</span>
<span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dygraph.html'>dygraph</a></span><span class='op'>(</span><span class='va'>dollar_growth</span>, main <span class='op'>=</span> <span class='st'>"Growth of $1 Invested in Portfolio"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dygraphs/man/dyAxis.html'>dyAxis</a></span><span class='op'>(</span><span class='st'>"y"</span>, label <span class='op'>=</span> <span class='st'>"$"</span><span class='op'>)</span>
</code></pre>
</div>
<div id="htmlwidget-de6c04d3a15b670239e0" style="width:624px;height:384px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-de6c04d3a15b670239e0">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Growth of $1 Invested in Portfolio","labels":["month","portfolio.wealthindex"],"legend":"auto","retainDateWindow":false,"ylabel":"$"},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-30T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-31T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-29T00:00:00.000Z","2018-04-30T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-31T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-31T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-17T00:00:00.000Z"],[0.908767017977322,0.898235333189972,0.989740900894519,0.964284245490375,0.884660116485374,0.786218395399551,0.851934208613984,0.837822259579873,0.978076232482116,1.03493014167304,1.04501246643032,1.10254033566597,1.08174536344046,1.10922547788832,1.11894752714777,1.15203057648609,1.13510290115903,1.13937020698963,1.23023137860026,1.16258338158476,1.10850210197715,1.1497967637701,1.05247804335069,1.01123222590816,1.07591495308302,1.04735331771028,1.16234635756184,1.22466886247291,1.08958826745244,1.15178255991649,1.18767873826196,1.25964508709896,1.31957677544363,1.22357314203004,1.28760086073592,1.30118070741259,1.37975872894277,1.40067110285981,1.39790255942251,1.3734789416343,1.46543296808611,1.4867689897646,1.57783122423775,1.46710013964654,1.58062544432516,1.78409213974043,1.91232622795434,1.95560245549105,1.8248027152576,1.85460866218366,1.75225041867719,1.59884936675464,1.64517244982762,1.70338868733678,1.66329579776248,1.75070058957119,1.70515110684204,1.6389404828636,1.72382224782538,1.63290703675638,1.72292637282581,1.84684355241776,1.81123699647763,1.96063232347818,1.99151375002077,2.00764039368857,2.35608253253411,2.25787101126226,2.2326392637999,2.61898481117416,2.76183768341474,2.80160307375964,2.47906848290785,2.32940380309798,2.48793484428492,2.65055992285943,2.86061910168299,2.79496531239225,2.97126415674299,3.01576666007343,3.20401671284148,3.08249353079512,2.99890822904158,3.03367558661574,3.24057657875221,3.34478149111039,3.44979459769554,3.59969966599956,3.80233525359638,3.72991524976942,3.8006629007542,3.78194416332747,3.76117890042605,4.196350545661,4.40951270838883,4.41641776290437,5.22999154909638,5.34954397609844,5.09412515503087,5.38865050491293,5.59074732983126,5.78255758309355,6.09698837608091,6.69138863434097,6.64131617919434,5.33417336834447,5.5878203721066,4.96570145991297,5.56200079131426,5.36203695951625,5.72520884270477,6.15341881924244,5.65073131095295,5.9513918028937,5.98233197843253,5.70239951628557,5.65248481437375,5.81031828390181,5.92776053956913,6.09725439839053,6.51159373961574,6.05046900980237,5.96534917537127,7.25475935041097,7.2311193616478,7.93312090706793,8.90155721010005,9.66138039147515,8.43516888061317]]},"evals":[],"jsHooks":[]}</script>
</div>
<p>A dollar would have grown quite nicely in this portfolio - about 2.5x - fantastic.</p>
<h2 id="calculating-the-sharpe-ratio">Calculating the Sharpe Ratio</h2>
<p>Now let’s look at the risk/reward of this portfolio by calculating the Sharpe Ratio. Briefly, the Sharpe Ratio is the mean of the excess monthly returns above the risk-free rate, divided by the standard deviation of the excess monthly returns above the risk-free rate. This is the formulation of the Sharpe Ratio as of 1994; if we wished to use the original formulation from 1966 the denominator would be the standard deviation of portfolio monthly returns. Learn more <a href="http://web.stanford.edu/~wfsharpe/art/sr/sr.htm">here</a>.</p>
<p>In other words, the Sharpe Ratio measures excess returns per unit of volatility, where we take the standard deviation to represent portfolio volatility. The Sharpe Ratio was brought to us by Bill Sharpe - arguably the most important economist for modern investment management as the creator of the Sharpe Ratio, CAPM and Financial Engines, a forerunner of today’s robo-advisor movement.</p>
<p>In the code chunk below, we’ll calculate the Sharpe Ratio in two ways.</p>
<p>First, we’ll use the Return.excess function from PerformanceAnalytics to calculate a time series of monthly excess returns. Two arguments need to be supplied: the time series of returns and the risk-free rate. The function will return a time series of excess returns, and we’ll take the mean of that time series to get the numerator of the Sharpe Ratio. Then we’ll divide by the standard deviation of the that time series to get the Sharpe Ratio.</p>
<p>Our second method is a bit easier. We’ll use the SharpeRatio function in PerformanceAnalytics, for which we’ll supply two arguments: a time series of monthly returns and risk-free rate.</p>
<p>For both methods I use a risk-free rate of .03% as the approximate mean of the 1-month Treasury bill rate since 2010. I’ll cover a quick way to grab this and other data via Quandl in a future post.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># Method 1: use the Return.excess function from PerformanceAnalytics,</span>
<span class='co'># then calculate the Sharpe Ratio manually.</span>
<span class='va'>portfolio_excess_returns</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/Return.excess.html'>Return.excess</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, 
                                          Rf <span class='op'>=</span> <span class='fl'>.0003</span><span class='op'>)</span>
<span class='va'>sharpe_ratio_manual</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>portfolio_excess_returns</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/StdDev.html'>StdDev</a></span><span class='op'>(</span><span class='va'>portfolio_excess_returns</span><span class='op'>)</span>, <span class='fl'>4</span>
<span class='op'>)</span>

<span class='co'># If we wanted to use the original, 1966 formulation of the Sharpe Ratio,</span>
<span class='co'># there is one small change to the code in Method 1</span>
<span class='va'>sharpe_ratio</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/PerformanceAnalytics/man/SharpeRatio.html'>SharpeRatio</a></span><span class='op'>(</span><span class='va'>portfolio_monthly_returns</span>, Rf <span class='op'>=</span> <span class='fl'>.0003</span><span class='op'>)</span>, <span class='fl'>4</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Using the Return.excess function and then dividing by the standard deviation of excess returns, the Sharpe Ratio is <code>sharpe_ratio_manual[,1]</code> = 0.2749.</p>
<p>Using the built in SharpeRatio function, the Sharpe Ratio is <code>sharpe_ratio[1,]</code> = 0.2749.</p>
<p>Alright, we have built a portfolio and calculated the Sharpe Ratio - and also set up some nice reusable chunks for data import, portfolio construction and visualization. We haven’t done anything terribly complex but this can serve as a useful paradigm to any collaborators, including our future selves, who want to reproduce this work, learn from this work, or expand upon this work.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/jjallaire/reproducible-finance-with-r/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
